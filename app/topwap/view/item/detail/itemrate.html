<style>
html,
body {
  background-color: #efeff4;
}

.shopex-bar~.shopex-content .shopex-fullscreen {
  top: 44px;
  height: auto;
}

.shopex-pull-top-tips {
  position: absolute;
  top: -20px;
  left: 50%;
  margin-left: -25px;
  width: 40px;
  height: 40px;
  border-radius: 100%;
  z-index: 1;
}

.shopex-bar~.shopex-pull-top-tips {
  top: 24px;
}

.shopex-pull-top-wrapper {
  width: 42px;
  height: 42px;
  display: block;
  text-align: center;
  background-color: #efeff4;
  border: 1px solid #ddd;
  border-radius: 25px;
  background-clip: padding-box;
  box-shadow: 0 4px 10px #bbb;
  overflow: hidden;
}

.shopex-pull-top-tips.shopex-transitioning {
  -webkit-transition-duration: 200ms;
  transition-duration: 200ms;
}

.shopex-pull-top-tips .shopex-pull-loading {
  /*-webkit-backface-visibility: hidden;
      -webkit-transition-duration: 400ms;
      transition-duration: 400ms;*/
  margin: 0;
}

.shopex-pull-top-wrapper .shopex-icon,
.shopex-pull-top-wrapper .shopex-spinner {
  margin-top: 7px;
}

.shopex-pull-top-wrapper .shopex-icon.shopex-reverse {
  /*-webkit-transform: rotate(180deg) translateZ(0);*/
}

.shopex-pull-bottom-tips {
  text-align: center;
  background-color: #efeff4;
  font-size: 15px;
  line-height: 40px;
  color: #777;
}

.shopex-pull-top-canvas {
  overflow: hidden;
  background-color: #fafafa;
  border-radius: 40px;
  box-shadow: 0 4px 10px #bbb;
  width: 40px;
  height: 40px;
  margin: 0 auto;
}

.shopex-pull-top-canvas canvas {
  width: 40px;
}

.shopex-slider-indicator.shopex-segmented-control {
  background-color: #efeff4;
}

.shopex-scroll > .shopex-table-view > .shopex-table-view-cell {
  padding: 0;
  background: #fff;
  margin-bottom: 10px;
}

.shopex-preview-image.shopex-fullscreen {
        position: fixed;
        z-index: 20;
        background-color: #000;
      }
      .shopex-preview-header,
      .shopex-preview-footer {
        position: absolute;
        width: 100%;
        left: 0;
        z-index: 10;
      }
      .shopex-preview-header {
        height: 44px;
        top: 0;
      }
      .shopex-preview-footer {
        height: 50px;
        bottom: 0px;
      }
      .shopex-preview-header .shopex-preview-indicator {
        display: block;
        line-height: 25px;
        color: #fff;
        text-align: center;
        margin: 15px auto 4px;
        width: 70px;
        background-color: rgba(0, 0, 0, 0.4);
        border-radius: 12px;
        font-size: 16px;
      }
      .shopex-preview-image {
        display: none;
        -webkit-animation-duration: 0.5s;
        animation-duration: 0.5s;
        -webkit-animation-fill-mode: both;
        animation-fill-mode: both;
      }
      .shopex-preview-image.shopex-preview-in {
        -webkit-animation-name: fadeIn;
        animation-name: fadeIn;
      }
      .shopex-preview-image.shopex-preview-out {
        background: none;
        -webkit-animation-name: fadeOut;
        animation-name: fadeOut;
      }
      .shopex-preview-image.shopex-preview-out .shopex-preview-header,
      .shopex-preview-image.shopex-preview-out .shopex-preview-footer {
        display: none;
      }
      .shopex-zoom-scroller {
        position: absolute;
        display: -webkit-box;
        display: -webkit-flex;
        display: flex;
        -webkit-box-align: center;
        -webkit-align-items: center;
        align-items: center;
        -webkit-box-pack: center;
        -webkit-justify-content: center;
        justify-content: center;
        left: 0;
        right: 0;
        bottom: 0;
        top: 0;
        width: 100%;
        height: 100%;
        margin: 0;
        -webkit-backface-visibility: hidden;
      }
      .shopex-zoom {
        -webkit-transform-style: preserve-3d;
        transform-style: preserve-3d;
      }
      .shopex-slider .shopex-slider-group .shopex-slider-item img {
        width: auto;
        height: auto;
        max-width: 100%;
        max-height: 100%;
      }
      .shopex-android-4-1 .shopex-slider .shopex-slider-group .shopex-slider-item img {
        width: 100%;
      }
      .shopex-android-4-1 .shopex-slider.shopex-preview-image .shopex-slider-group .shopex-slider-item {
        display: inline-table;
      }
      .shopex-android-4-1 .shopex-slider.shopex-preview-image .shopex-zoom-scroller img {
        display: table-cell;
        vertical-align: middle;
      }
      .shopex-preview-loading {
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        display: none;
      }
      .shopex-preview-loading.shopex-active {
        display: block;
      }
      .shopex-preview-loading .shopex-spinner-white {
        position: absolute;
        top: 50%;
        left: 50%;
        margin-left: -25px;
        margin-top: -25px;
        height: 50px;
        width: 50px;
      }
      .shopex-preview-image img.shopex-transitioning {
        -webkit-transition: -webkit-transform 0.5s ease, opacity 0.5s ease;
        transition: transform 0.5s ease, opacity 0.5s ease;
      }
      @-webkit-keyframes fadeIn {
        0% {
          opacity: 0;
        }
        100% {
          opacity: 1;
        }
      }
      @keyframes fadeIn {
        0% {
          opacity: 0;
        }
        100% {
          opacity: 1;
        }
      }
      @-webkit-keyframes fadeOut {
        0% {
          opacity: 1;
        }
        100% {
          opacity: 0;
        }
      }
      @keyframes fadeOut {
        0% {
          opacity: 1;
        }
        100% {
          opacity: 0;
        }
      }
      p img {
        max-width: 100%;
        height: auto;
      }
</style>
<header class="page-header">
  <i class="header-left icon-func bbc-icon bbc-icon-back shopex-action-back"></i>
  <div class="header-title">
    <{$title}>
  </div>
</header>
<section class="container">
  <div id="slider" class="shopex-slider shopex-fullscreen bbc-pullrefresh-top">
    <div id="sliderSegmentedControl" class="shopex-scroll-wrapper shopex-slider-indicator shopex-segmented-control shopex-segmented-control-inverted">
      <div class="shopex-scroll">
        <a class="shopex-control-item shopex-active" data-status="0" href="#item1mobile"><{t}>全部<{/t}></a>
        <a class="shopex-control-item " data-status="1" href="#item2mobile"><{t}>好评<{/t}></a>
        <a class="shopex-control-item " data-status="2" href="#item3mobile"><{t}>中评<{/t}></a>
        <a class="shopex-control-item " data-status="3" href="#item4mobile"><{t}>差评<{/t}></a>
        <a class="shopex-control-item " data-status="4" href="#item5mobile"><{t}>晒图<{/t}></a>
      </div>
    </div>
    <div class="shopex-slider-group">
      <div id="item1mobile" class="shopex-slider-item shopex-control-content shopex-active">
        <div id="scroll1" class="shopex-scroll-wrapper">
          <div class="shopex-scroll" data-count="1">
            <ul class="shopex-table-view rate-list">
            </ul>
          </div>
        </div>
      </div>
      <div id="item2mobile" class="shopex-slider-item shopex-control-content">
        <div id="scroll2" class="shopex-scroll-wrapper">
          <div class="shopex-scroll" data-count="1">
            <ul class="shopex-table-view rate-list">
              <div class="shopex-loading">
                <div class="shopex-spinner">
                </div>
              </div>
            </ul>
          </div>
        </div>
      </div>
      <div id="item3mobile" class="shopex-slider-item shopex-control-content">
        <div id="scroll3" class="shopex-scroll-wrapper">
          <div class="shopex-scroll" data-count="1">
            <ul class="shopex-table-view rate-list">
              <div class="shopex-loading">
                <div class="shopex-spinner">
                </div>
              </div>
            </ul>
          </div>
        </div>
      </div>
      <div id="item4mobile" class="shopex-slider-item shopex-control-content">
        <div id="scroll4" class="shopex-scroll-wrapper">
          <div class="shopex-scroll" data-count="1">
            <ul class="shopex-table-view rate-list">
              <div class="shopex-loading">
                <div class="shopex-spinner">
                </div>
              </div>
            </ul>
          </div>
        </div>
      </div>
      <div id="item5mobile" class="shopex-slider-item shopex-control-content">
        <div id="scroll5" class="shopex-scroll-wrapper">
          <div class="shopex-scroll" data-count="1">
            <ul class="shopex-table-view rate-list">
              <div class="shopex-loading">
                <div class="shopex-spinner">
                </div>
              </div>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<{script src="shopex.pullToRefresh.js" app=topwap}>
<{script src="shopex.pullToRefresh.material.js" app=topwap}>
<script>
shopex.init();
(function() {
  var totalpage;
  //阻尼系数
  var deceleration = shopex.os.ios ? 0.003 : 0.0009;
  shopex('.shopex-scroll-wrapper').scroll({
    bounce: false,
    indicators: true, //是否显示滚动条
    deceleration: deceleration
  });
  shopex.ready(function() {
    shopex('.shopex-scroll-wrapper').scroll({
      indicators: true //是否显示滚动条
    });
    var active = document.getElementById('sliderSegmentedControl').querySelector('.shopex-active');
    var activeId = document.getElementById('item' + active.dataset.status + 'mobile');
    var item1 = document.getElementById('item1mobile');
    var item2 = document.getElementById('item2mobile');
    var item3 = document.getElementById('item3mobile');
    var item4 = document.getElementById('item4mobile');
    var item5 = document.getElementById('item5mobile');
    if (active.dataset.status != 0) {
      shopex('#slider').slider().gotoItem(active.dataset.status, 1);
    } else {
      setTimeout(function() {
        var el = item1.querySelector('.shopex-table-view');
        getList(0, 1, el, item1, false);
      }, 200);
    }

    document.getElementById('slider').addEventListener('slide', function(e) {
      if (e.detail.slideNumber === 0) {
        if (item1.querySelector('.shopex-loading')) {
          setTimeout(function() {
            count = 1;
            var el = item1.querySelector('.shopex-table-view');
            getList(e.detail.slideNumber, 1, el, item1, false);
          }, 200);
        }
      }
      if (e.detail.slideNumber === 1) {
        if (item2.querySelector('.shopex-loading')) {
          setTimeout(function() {
            count = 1;
            var el = item2.querySelector('.shopex-table-view');
            getList(e.detail.slideNumber, 1, el, item2, false);
          }, 200);
        }
      } else if (e.detail.slideNumber === 2) {
        if (item3.querySelector('.shopex-loading')) {
          setTimeout(function() {
            count = 1;
            var el = item3.querySelector('.shopex-table-view');
            getList(e.detail.slideNumber, 1, el, item3, false);
          }, 200);
        }
      } else if (e.detail.slideNumber === 3) {
        if (item4.querySelector('.shopex-loading')) {
          setTimeout(function() {
            count = 1;
            var el = item4.querySelector('.shopex-table-view');
            getList(e.detail.slideNumber, 1, el, item4, false);
          }, 200);
        }
      } else if (e.detail.slideNumber === 4) {
        if (item5.querySelector('.shopex-loading')) {
          setTimeout(function() {
            count = 1;
            var el = item5.querySelector('.shopex-table-view');
            getList(e.detail.slideNumber, 1, el, item5, false);
          }, 200);
        }
      }
    });

    var count = 1;
    //循环初始化所有下拉刷新，上拉加载。
    shopex.each(document.querySelectorAll('.shopex-slider-group .shopex-scroll'), function(index, pullRefreshEl) {
      shopex(pullRefreshEl).pullToRefresh({
        down: {
          callback: function() {
            count = 1;
            var self = this;
            setTimeout(function() {
              var ul = self.element.querySelector('.shopex-table-view');
              getList(index, count, ul, null, false);
              self.endPullDownToRefresh();
              self.refresh(self.element);
            }, 1000);
          }
        },
        up: {
          callback: function() {
            var self = this;
            setTimeout(function() {
              count = self.element.dataset.count;
              shopex(self.element).pullToRefresh().endPullUpToRefresh(++count > totalpage);
              var ul = self.element.querySelector('.shopex-table-view');
              if(!(count > totalpage)){
                getList(index, count, ul, null, true);
              }
            }, 1000);
          }
        }
      });
    });

    var getList = function(status, num, el, emptyel, isPullup) {
      $.ajax({
        url: '<{url action=topwap_ctl_item_detail@getItemRateList}>',
        type: 'get',
        dataType: 'json',
        data: {
          'rate_type': status,
          'pages': num,
          'item_id':"<{$item_id}>"
        },
        success: function(rs) {
          totalpage = rs.total;
          $(el).parent().attr('data-count', count);
          if (isPullup == false) {
            if(rs.html.indexOf('nodata-wrapper') > 0){
              $(el).parent().parent().html(rs.html);
            } else {
              $(el).html(rs.html);
            }
          } else {
            $(el).append(rs.html);
          }
        }
      });
    };
  });

  shopex.previewImage();
})();
</script>
